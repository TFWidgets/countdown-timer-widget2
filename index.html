<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Countdown Timer Widget — Configurator (локально)</title>
  <style>
    :root{font-family:Inter,system-ui,sans-serif}
    body{margin:0;background:#f5f3ee;color:#222}
    .page{max-width:1100px;margin:28px auto;padding:24px}
    h1{font-size:28px;text-align:center;margin:8px 0 20px}
    .layout{display:flex;flex-direction:column;align-items:center;gap:32px;}
    .panel{background:#fff;border-radius:10px;padding:16px;box-shadow:0 6px 20px rgba(0,0,0,0.06)}
    .preview-wrap{display:flex;justify-content:center;align-items:flex-start;padding:40px;margin-bottom: 40px;}
    label{display:block;margin-top:12px;font-size:13px;color:#444}
    input[type=text], input[type=datetime-local], select{width:100%;padding:8px;border:1px solid #ddd;border-radius:6px;margin-top:6px}
    .row{display:flex;gap:8px}
    .color{display:flex;align-items:center;gap:8px}
    .btn{display:inline-block;padding:8px 12px;border-radius:8px;border:0;background:#3b82f6;color:#fff;cursor:pointer;margin-top:12px}
    .btn.secondary{background:#efefef;color:#222}
    textarea{width:100%;height:120px;padding:8px;border-radius:6px;border:1px solid #ddd;margin-top:8px}
    .small{font-size:12px;color:#666}
    footer{margin-top:28px;text-align:center;color:#666;font-size:13px}
    /* встроенные стили для виджета (по умолчанию) */
  </style>
</head>
<body>
  <div class="page">
    <h1>Конфигуратор Countdown Timer Widget — локально</h1>
    <div>
        <div class="panel preview-wrap">
          <!-- место для превью виджета -->
          <div id="preview-root" style="width:100%;display:flex;justify-content:center"></div>
        </div>

        
      </div>
    
    <div class="layout">
      <div class="panel" style="width:400px">
        <h3>Настройки</h3>
        <label>Дата и время окончания</label>
        <input id="cfg-enddate" type="datetime-local" />


        <label>Фон виджета (градиент)</label>
<div class="gradient-picker">
  <div class="row">
    <div style="flex:1">
      <label class="small">Цвет 1</label>
      <input id="cfg-gradient-start" type="color" value="#C44536">
    </div>
    <div style="flex:1">
      <label class="small">Цвет 2</label>
      <input id="cfg-gradient-end" type="color" value="#D07C47">
    </div>
  </div>
  <label class="small" style="margin-top:6px;">Направление</label>
  <select id="cfg-gradient-angle">
    <option value="90deg">Слева направо</option>
    <option value="180deg">Сверху вниз</option>
    <option value="135deg" selected>Диагональ ↘</option>
    <option value="45deg">Диагональ ↗</option>
  </select>
</div>


        <div class="row">
          <div style="flex:1">
            <label>Цвет текста</label>
            <input id="cfg-text" type="color" />
          </div>
          <div style="flex:1">
            <label>Цвет блока</label>
            <input id="cfg-block-bg" type="color" />
          </div>
        </div>

        <label>Радиус виджета (px)</label>
        <input id="cfg-radius-widget" type="number" value="16" />
        <label>Радиус блоков (px)</label>
        <input id="cfg-radius-blocks" type="number" value="12" />

       

        <div style="display:flex;gap:8px;margin-top:12px">
          <button id="apply-btn" class="btn">Применить</button>
          <button id="export-btn" class="btn secondary">Экспорт JSON</button>
        </div>

        <label class="small">JSON-конфиг</label>
        <textarea id="cfg-json" readonly></textarea>
      </div>

      <div class="panel" style="margin-top:18px">
          <h3>Инструкция</h3>
          <p class="small">Изменяй настройки слева и нажимай «Применить» — предпросмотр обновится локально. Нажми «Экспорт JSON», чтобы скопировать конфигурацию в буфер обмена.</p>
        </div>
    </div>

    <footer>Локальная версия — не отправляет данные на GitHub. Открой этот файл в браузере.</footer>
  </div>

  <!-- Локальный JSON-конфиг: виджет читает его, когда clientId === 'local' -->
  <script id="bhw-countdown-local-config" type="application/json">
  </script>

  <!-- Скрипт виджета (адаптирован для локального использования и повторного инициализирования) -->
  <script>
  // --- BEGIN: адаптированный код виджета (на основе присланного тобой) ---
  (function(window){
    'use strict';

    // Вспомогательные функции и стили (слегка упрощены)
    const inlineCSS = `
      .bhw-container{font-family:var(--bhw-font,'Inter',system-ui,sans-serif);max-width:var(--bhw-max-width,380px);margin:20px auto;width:100%}
      .bhw-widget{background:var(--bhw-bg,linear-gradient(135deg,#C44536 0%,#D07C47 100%));border-radius:var(--bhw-widget-radius,16px);padding:var(--bhw-padding,28px);color:var(--bhw-text-color,#ffffff);box-shadow:var(--bhw-shadow,0 16px 48px rgba(0,0,0,0.25));position:relative;overflow:hidden;text-align:center}
      .bhw-countdown{display:grid;grid-template-columns:repeat(4,1fr);gap:var(--bhw-gap,15px);margin:var(--bhw-countdown-margin,20px 0);position:relative}
      .bhw-time-block{background:var(--bhw-block-bg,rgba(255,255,255,0.22));border:var(--bhw-block-border,2px solid rgba(255,255,255,0.35));border-radius:var(--bhw-block-radius,12px);padding:var(--bhw-block-padding,16px 8px);backdrop-filter:blur(12px)}
      .bhw-time-value{font-size:var(--bhw-value-size,1.8em);font-weight:700;font-family:var(--bhw-value-font,'JetBrains Mono',monospace);margin-bottom:4px}
      .bhw-time-label{font-size:var(--bhw-label-size,.7em);font-weight:600;opacity:.9;text-transform:uppercase}
      @media (max-width:480px){.bhw-countdown{grid-template-columns:repeat(2,1fr)}}
    `;

    if (!document.querySelector('#bhw-inline-styles')){
      const st = document.createElement('style'); st.id = 'bhw-inline-styles'; st.textContent = inlineCSS; document.head.appendChild(st);
    }

    // expose a global helper so configurator can re-init the widget
    window.BHW = window.BHW || {};

    function escapeHtml(text){ const d=document.createElement('div'); d.textContent = text||''; return d.innerHTML; }

    function generateUniqueStyles(uniqueClass, style){
      const s = style||{}; const colors = s.colors||{}; const sizes = s.sizes||{}; const borderRadius = s.borderRadius||{}; const shadow = s.shadow||{}; const fs = sizes.fontSize||1;
      return `.${uniqueClass}{--bhw-font:${s.fontFamily||"'Inter', system-ui, sans-serif"};--bhw-max-width:${Math.round(380*fs)}px;--bhw-bg:${colors.background||"linear-gradient(135deg,#C44536 0%,#D07C47 100%)"};--bhw-widget-radius:${borderRadius.widget||16}px;--bhw-padding:${sizes.padding||28}px;--bhw-padding-mobile:${Math.round((sizes.padding||28)*0.8)}px;--bhw-text-color:${colors.text||'#ffffff'};--bhw-shadow:${(shadow.widget||"0 16px 48px rgba(0,0,0,0.25)")};--bhw-shadow-hover:${(shadow.widgetHover||"0 24px 64px rgba(0,0,0,0.35)")};--bhw-gap:${sizes.gap||15}px;--bhw-gap-mobile:${Math.round((sizes.gap||15)*0.8)}px;--bhw-countdown-margin:${Math.round(20*fs)}px 0;--bhw-block-bg:${colors.blockBackground||'rgba(255, 255, 255, 0.22)'};--bhw-block-border:2px solid ${colors.blockBorder||'rgba(255,255,255,0.35)'};--bhw-block-radius:${borderRadius.blocks||12}px;--bhw-block-padding:${sizes.blockPadding||16}px ${Math.round((sizes.blockPadding||16)*0.5)}px;--bhw-block-bg-hover:${colors.blockHover||'rgba(255,255,255,0.3)'};--bhw-block-border-hover:${colors.borderHover||'rgba(255,255,255,0.55)'};--bhw-value-size:${1.8*fs}em;--bhw-value-size-mobile:${1.5*fs}em;--bhw-label-size:${0.7*fs}em;--bhw-label-size-mobile:${0.65*fs}em;--bhw-text-shadow:${shadow.text||'0 2px 8px rgba(0,0,0,0.3)'};--bhw-value-font:${s.valueFontFamily||"'JetBrains Mono', 'SF Mono', monospace"}}`;
    }

    function applyCustomStyles(uniqueClass, style){
      const styleId = `bhw-countdown-style-${uniqueClass}`; let el = document.getElementById(styleId);
      if (!el){ el = document.createElement('style'); el.id = styleId; document.head.appendChild(el);} el.textContent = generateUniqueStyles(uniqueClass, style);
    }

    function createCountdownWidgetIn(container, config){
      const labels = config.labels || {};
      container.innerHTML = `\n        <div class="bhw-widget">\n          <div class="bhw-countdown">\n            <div class="bhw-time-block">\n              <div class="bhw-time-value" data-unit="days">00</div>\n              <div class="bhw-time-label">${escapeHtml(labels.days)}</div>\n            </div>\n            <div class="bhw-time-block">\n              <div class="bhw-time-value" data-unit="hours">00</div>\n              <div class="bhw-time-label">${escapeHtml(labels.hours)}</div>\n            </div>\n            <div class="bhw-time-block">\n              <div class="bhw-time-value" data-unit="minutes">00</div>\n              <div class="bhw-time-label">${escapeHtml(labels.minutes)}</div>\n            </div>\n            <div class="bhw-time-block">\n              <div class="bhw-time-value" data-unit="seconds">00</div>\n              <div class="bhw-time-label">${escapeHtml(labels.seconds)}</div>\n            </div>\n          </div>\n        </div>\n      `;

      // запускаем таймер
      startCountdown(container, config.endDate);
    }

    function startCountdown(container, endDate){
      const endTime = new Date(endDate).getTime();
      if (container._countdownInterval) clearInterval(container._countdownInterval);
      function update(){
        const now = Date.now(); const timeLeft = endTime - now;
        if (timeLeft <= 0){ ['days','hours','minutes','seconds'].forEach(u => { const el = container.querySelector(`[data-unit="${u}"]`); if(el) el.textContent='00'; }); clearInterval(container._countdownInterval); return; }
        const days = Math.floor(timeLeft / (1000*60*60*24));
        const hours = Math.floor((timeLeft % (1000*60*60*24)) / (1000*60*60));
        const minutes = Math.floor((timeLeft % (1000*60*60)) / (1000*60));
        const seconds = Math.floor((timeLeft % (1000*60)) / 1000);
        const setVal = (u,v)=>{ const e = container.querySelector(`[data-unit="${u}"]`); if(e) e.textContent=String(v).padStart(2,'0'); };
        setVal('days', days); setVal('hours', hours); setVal('minutes', minutes); setVal('seconds', seconds);
      }
      update(); container._countdownInterval = setInterval(update, 1000);
    }

    // Главная функция: инициализировать превью по конфигу
    window.BHW.initPreview = function(targetEl, config){
      // применяем стили
      const uniqueClass = 'bhw-local-'+(Date.now());
      targetEl.className = 'bhw-container '+uniqueClass;
      applyCustomStyles(uniqueClass, config.style || {});
      createCountdownWidgetIn(targetEl, config);
    };

  })(window);
  // --- END: адаптированный код виджета ---
  </script>

  <!-- Скрипт конфигуратора: связывает UI и превью -->
  <script>
    // Значения по умолчанию
    const defaultConfig = {
      endDate: new Date(new Date().getTime() + 7*24*3600*1000).toISOString().slice(0,19), // +7 days (UTC format for internal use)
      labels: { days: 'DAYS', hours: 'HOURS', minutes: 'MINUTES', seconds: 'SECONDS' },
      style: {
        fontFamily: "'Inter', system-ui, sans-serif",
        valueFontFamily: "'JetBrains Mono', 'SF Mono', monospace",
        colors: {
          background: "linear-gradient(135deg,#C44536 0%,#D07C47 100%)",
          text: "#ffffff",
          blockBackground: "rgba(255,255,255,0.22)",
          blockBorder: "rgba(255,255,255,0.35)",
          blockHover: "rgba(255,255,255,0.3)",
          borderHover: "rgba(255,255,255,0.55)"
        },
        borderRadius: { widget: 16, blocks: 12 },
        sizes: { fontSize: 1, padding: 28, blockPadding: 16, gap: 15 },
        shadow: { widget: "0 16px 48px rgba(0,0,0,0.25)", widgetHover: "0 24px 64px rgba(0,0,0,0.35)", text: "0 2px 8px rgba(0,0,0,0.3)" }
      }
    };

    // элементы UI
    const el = id => document.getElementById(id);
    const previewRoot = el('preview-root');

    function toLocalDatetimeInputValue(isoString){
      // isoString like 2025-12-31T23:59:59 -> convert to local for datetime-local input
      const d = new Date(isoString);
      const tzOffset = d.getTimezoneOffset()*60000; // in ms
      const local = new Date(d.getTime() - tzOffset);
      return local.toISOString().slice(0,19);
    }

    function toIsoFromLocalInput(localValue){
      if(!localValue) return new Date().toISOString();
      // treat input as local time without timezone
      const t = new Date(localValue);
      // convert local to ISO (UTC)
      const iso = new Date(t.getTime() + t.getTimezoneOffset()*60000).toISOString();
      return iso;
    }

    function loadUIFromConfig(cfg){
      el('cfg-enddate').value = toLocalDatetimeInputValue(cfg.endDate);

      // colors: if color is a gradient, keep text in input but color picker can't show gradient; show text in bg input
      
      // try to detect simple color for pickers
      try{ el('cfg-text').value = cfg.style.colors.text || '#ffffff'; }catch(e){ el('cfg-text').value='#ffffff'; }
      try{ el('cfg-block-bg').value = (cfg.style.colors.blockBackground && cfg.style.colors.blockBackground.match(/rgba?\(([^)]+)\)/)) ? '#ffffff' : '#ffffff'; }catch(e){ el('cfg-block-bg').value='#ffffff'; }
      el('cfg-radius-widget').value = cfg.style.borderRadius.widget || 16;
      el('cfg-radius-blocks').value = cfg.style.borderRadius.blocks || 12;
    }

    function buildConfigFromUI(){
      const endLocal = el('cfg-enddate').value;
      const iso = toIsoFromLocalInput(endLocal);
      const cfg = JSON.parse(JSON.stringify(defaultConfig));
      cfg.endDate = iso;

      const gradStart = el('cfg-gradient-start')?.value || '#C44536';
const gradEnd = el('cfg-gradient-end')?.value || '#D07C47';
const gradAngle = el('cfg-gradient-angle')?.value || '135deg';
cfg.style.colors.background = `linear-gradient(${gradAngle}, ${gradStart} 0%, ${gradEnd} 100%)`;

      cfg.style.colors.text = el('cfg-text').value || cfg.style.colors.text;
      cfg.style.colors.blockBackground = el('cfg-block-bg').value || cfg.style.colors.blockBackground;
      cfg.style.borderRadius.widget = Number(el('cfg-radius-widget').value || 16);
      cfg.style.borderRadius.blocks = Number(el('cfg-radius-blocks').value || 12);
      return cfg;
    }

    function updatePreview(cfg){
      // put config into local script element (optional) so you can inspect
      const localScript = document.getElementById('bhw-countdown-local-config');
      localScript.textContent = JSON.stringify(cfg, null, 2);

      // render
      // clear preview root
      previewRoot.innerHTML = '';
      const target = document.createElement('div'); target.style.width='380px';
      previewRoot.appendChild(target);
      // call widget's preview initializer
      window.BHW.initPreview(target, cfg);

      // update JSON textarea
      el('cfg-json').value = JSON.stringify(cfg, null, 2);
    }

    // инициализация UI
    function init(){
      const initial = JSON.parse(JSON.stringify(defaultConfig));
      // default end date: keep as ISO (UTC)
      initial.endDate = new Date(new Date().getTime() + 7*24*3600*1000).toISOString();

      loadUIFromConfig(initial);
      updatePreview(initial);

      document.getElementById('apply-btn').addEventListener('click', ()=>{
        const cfg = buildConfigFromUI();
        updatePreview(cfg);
      });

      document.getElementById('export-btn').addEventListener('click', async ()=>{
        const cfg = buildConfigFromUI();
        // copy to clipboard
        try{ await navigator.clipboard.writeText(JSON.stringify(cfg, null, 2)); alert('JSON скопирован в буфер обмена'); }
        catch(e){ el('cfg-json').select(); alert('Не удалось скопировать автоматически — скопируй вручную из поля'); }
      });
    }

    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
